{"version":3,"sources":["../../app/models/sensorModel.js"],"names":["Schema","SensorSchema","id","type","String","required","unique","name","position","lat","Number","lng","last_connection","Date","last_event","cluster","ObjectId","ref","toJSON","virtuals","virtual","get","now","sensorModel","model"],"mappings":";;;;;;;AAAA;;;;AACA;;;;;;AACA,IAAMA,SAAS,mBAASA,MAAxB;;AAEA,IAAMC,eAAeD,OAAO;AAC1BE,MAAI,EAACC,MAAMC,MAAP,EAAeC,UAAU,IAAzB,EAA+BC,QAAQ,IAAvC,EADsB;AAE1BC,QAAM,EAACJ,MAAMC,MAAP,EAAeC,UAAU,IAAzB,EAFoB;AAG1BG,YAAU;AACRC,SAAK,EAACN,MAAMO,MAAP,EAAeL,UAAU,IAAzB,EADG;AAERM,SAAK,EAACR,MAAMO,MAAP,EAAeL,UAAU,IAAzB;AAFG,GAHgB;AAO1BO,mBAAiB,EAACT,MAAMU,IAAP,EAAaR,UAAU,KAAvB,EAPS;AAQ1BS,cAAY,EAACX,MAAMU,IAAP,EAAaR,UAAU,KAAvB,EARc;AAS1BU,WAAS,EAACZ,MAAMH,OAAOgB,QAAd,EAAwBC,KAAK,SAA7B,EAAwCZ,UAAU,IAAlD;AATiB,CAAP,EAWrB;AACEa,UAAQ,EAACC,UAAU,IAAX;AADV,CAXqB,CAArB;;AAgBAlB,aAAamB,OAAb,CAAqB,UAArB,EAAiCC,GAAjC,CAAqC,YAAY;AAC/C,MAAI,KAAKT,eAAL,IAAwB,IAAxB,IAAgC,KAAKA,eAAL,IAAwB,EAA5D,EAAgE,OAAO,KAAP;AAChE,MAAIA,kBAAkB,sBAAO,KAAKA,eAAZ,CAAtB;AACA,MAAIU,MAAM,uBAAV;;AAEA,MAAKA,MAAMV,eAAP,GAA0B,KAA9B,EAAqC,OAAO,KAAP;AACrC,SAAO,IAAP;AACD,CAPD;;AASO,IAAMW,oCAAc,mBAASC,KAAT,CAAe,QAAf,EAAyBvB,YAAzB,CAApB","file":"sensorModel.js","sourcesContent":["import mongoose from 'mongoose'\nimport moment from 'moment'\nconst Schema = mongoose.Schema\n\nconst SensorSchema = Schema({\n  id: {type: String, required: true, unique: true},\n  name: {type: String, required: true},\n  position: {\n    lat: {type: Number, required: true},\n    lng: {type: Number, required: true}\n  },\n  last_connection: {type: Date, required: false},\n  last_event: {type: Date, required: false},\n  cluster: {type: Schema.ObjectId, ref: 'Cluster', required: true}\n},\n{\n  toJSON: {virtuals: true}\n}\n)\n\nSensorSchema.virtual('isOnline').get(function () {\n  if (this.last_connection == null || this.last_connection == '') return false\n  let last_connection = moment(this.last_connection)\n  let now = moment()\n\n  if ((now - last_connection) > 90000) return false\n  return true\n})\n\nexport const sensorModel = mongoose.model('Sensor', SensorSchema)\n"]}